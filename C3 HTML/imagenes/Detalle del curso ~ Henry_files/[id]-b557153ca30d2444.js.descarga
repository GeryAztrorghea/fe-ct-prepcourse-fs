(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4288],{26068:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/course-detail/[courseId]/lecture/[id]",function(){return r(13742)}])},13742:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return w}});var o=r(85893),n=r(95591),s=r(67294),a=r(96486),i=r(11163),u=r(44334),c=r(51534),l=r(59927),d=r(88919),m=r(94184),g=r.n(m),_=r(52438),f=r(41749),h=r.n(f);const v=t=>{let{url:e,isMd:r,isMobile:n,iframeReady:a,iframeOnload:i,showAnimationLottie:u}=t;const[c,l]=(0,s.useState)(),m=g()(h().iframe,{[h().iframeMobile]:n,[h().iframeMd]:r}),f=g()(h().button,{[h().hideButton]:n}),{buttonContent:v,handleClick:C}=(0,s.useContext)(_.ViewportControlContext);return(0,s.useEffect)((()=>{c||l((new Date).getTime())}),[]),(0,o.jsxs)(o.Fragment,{children:[u&&(0,o.jsx)("div",{className:h().lottie,children:(0,o.jsx)(d.ce$,{})}),c&&(0,o.jsxs)("div",{className:h().scormContent,children:[(0,o.jsx)(d.zxk,{className:f,onClick:C,children:v}),(0,o.jsx)("iframe",{className:m,title:"Lecture scorm",id:"main-iframe",src:a?"".concat(e,"?v=").concat(c):void 0,width:"100%",allow:"autoplay; fullscreen; picture-in-picture",frameBorder:0,onLoad:i})]})]})};const C=()=>{const[t,e]=(0,s.useState)(),[r,o]=(0,s.useState)(""),m=(0,i.useRouter)(),g=(0,l.R$)(m.query.id),_=(0,l.R$)(m.query.idModLecture),{mutate:f}=(0,n.kY)(),{trigger:h}=(0,u.Z)(["lecture-controller-update-scorm-tracking",t,r],(0,d.G09)(c.Z.henry.lectureControllerUpdateScormTracking)),v={scormConfig:JSON.stringify(null===t||void 0===t?void 0:t.changeProgress),lastBookmark:r,status:null===t||void 0===t?void 0:t.status};return(0,s.useEffect)((()=>{window.addEventListener("message",(t=>{var e;"SET_BOOKMARK"===t.data.type&&(e=t.data.data,o(e))}),!1),window.addEventListener("message",(t=>{var r;"SET_PROGRESS"===t.data.type&&(r=t.data.data,e(r))}),!1),(t&&r||"NOT_STARTED"===(null===t||void 0===t?void 0:t.status))&&h({id:g,data:v}).then((()=>{_&&"undefined"!==_&&f(["lectureControllerGetModulesLectures",_]).catch(a.noop)})).catch(a.noop)}),[r,t]),{progress:(null===t||void 0===t?void 0:t.changeProgress)||{},last_bookmark:r,status:null===t||void 0===t?void 0:t.status}};const p=t=>{const{handleCompletedScorm:e,scormContent:r}=t,n=(0,d.cKm)(),a="sm"===n,i="md"===n,u=C(),[c,l]=(0,s.useState)(!1),[m,g]=(0,s.useState)(!1),[_,f]=(0,s.useState)(!1),h="COMPLETED"===u.status,p="COMPLETED"===(null===r||void 0===r?void 0:r.status);return(0,s.useEffect)((()=>{r||c||f(!0),r&&(l(!0),m||!h||p||(g(!0),e()))}),[c,r,m,h,e,p]),(0,o.jsx)(v,{...t,isMd:i,isMobile:a,iframeReady:c,iframeOnload:()=>{const t=document.getElementById("main-iframe");if(t&&t.contentWindow){if(r&&c&&r.progress){const o=JSON.parse(null===r||void 0===r?void 0:r.progress);var e;t.contentWindow.postMessage({type:"LOAD_SCORM",data:{progress:null!==o&&void 0!==o?o:u.progress,last_bookmark:null!==(e=null===r||void 0===r?void 0:r.lastBookmark)&&void 0!==e?e:u.last_bookmark,isMobile:a,isMd:i}},"*"),f(!1)}var o;if(!(null===r||void 0===r?void 0:r.progress)&&c)t.contentWindow.postMessage({type:"LOAD_SCORM",data:{progress:u.progress,last_bookmark:null!==(o=null===r||void 0===r?void 0:r.lastBookmark)&&void 0!==o?o:u.last_bookmark,isMobile:a,isMd:i}},"*"),f(!1)}},isLectureCompleted:h,showAnimationLottie:_})};var k=r(37174),M=r(80795);var w=()=>{const t=(0,i.useRouter)(),e=(0,l.R$)(t.query.courseId),r=(0,l.R$)(t.query.id),s=(0,l.R$)(t.query.idModLecture),m=(0,l.R$)(t.query.lectureUrl),{data:g,mutate:_,isLoading:f}=(0,n.ZP)(r?["lecture-controller-get-scorm-content-progress",r]:null,(0,d.Oyn)(c.Z.henry.lectureControllerGetScormContentProgress,r)),{trigger:h,isMutating:v}=(0,u.Z)("tracking-controller-watch-lecture",(0,d.NNl)(c.Z.henry.trackingControllerWatchLecture)),C={caption:"Volver",href:{pathname:k.j.courseDetailContent.url,query:{courseId:e}}};return g?(0,o.jsx)(M.default,{courseId:e,title:"Detalle del curso",isLoading:f||v,prevLink:C,showLectureSidebar:!0,children:(0,o.jsx)(p,{url:m,scormContent:g,isLoading:f||v,handleCompletedScorm:()=>{h({cohort:null,module:s,lecture:r}).then(a.noop).catch(a.noop),_().then(a.noop).catch(a.noop)}})}):null}},41749:function(t){t.exports={iframe:"lecture-scorm_iframe__1S3S8",iframeMd:"lecture-scorm_iframeMd__k5bIY",iframeMobile:"lecture-scorm_iframeMobile__pdbRO",buttonsContainer:"lecture-scorm_buttonsContainer__1xOFv",linksContainer:"lecture-scorm_linksContainer__tRAxx",buttonContainer:"lecture-scorm_buttonContainer__lFBzl",textContainer:"lecture-scorm_textContainer__9qCOH",lottie:"lecture-scorm_lottie__lUyOa",button:"lecture-scorm_button__7UOiv",hideButton:"lecture-scorm_hideButton__xgpNc",scormContent:"lecture-scorm_scormContent__gDRoC"}},44334:function(t,e,r){"use strict";r.d(e,{Z:function(){return i}});var o=r(67294),n=r(95591),s=r(11753);const a=s.w6?t=>{t()}:o.startTransition,i=(0,s.xD)(n.ZP,(()=>(t,e,r={})=>{const{mutate:i}=(0,n.kY)(),u=(0,o.useRef)(t),c=(0,o.useRef)(e),l=(0,o.useRef)(r),d=(0,o.useRef)(0),[m,g,_]=(t=>{const[,e]=(0,o.useState)({}),r=(0,o.useRef)(!1),n=(0,o.useRef)(t),a=(0,o.useRef)({data:!1,error:!1,isValidating:!1}),i=(0,o.useCallback)((t=>{let o=!1;const s=n.current;for(const e in t){const r=e;s[r]!==t[r]&&(s[r]=t[r],a.current[r]&&(o=!0))}o&&!r.current&&e({})}),[]);return(0,s.LI)((()=>(r.current=!1,()=>{r.current=!0}))),[n,a.current,i]})({data:s.i_,error:s.i_,isMutating:!1}),f=m.current,h=(0,o.useCallback)((async(t,e)=>{const[r,o]=(0,s.qC)(u.current);if(!c.current)throw new Error("Can\u2019t trigger the mutation: missing fetcher.");if(!r)throw new Error("Can\u2019t trigger the mutation: missing key.");const n=(0,s.PM)((0,s.PM)({populateCache:!1,throwOnError:!0},l.current),e),m=(0,s.u3)();d.current=m,_({isMutating:!0});try{const e=await i(r,c.current(o,{arg:t}),(0,s.PM)(n,{throwOnError:!0}));var g,f;if(d.current<=m)a((()=>_({data:e,isMutating:!1,error:void 0}))),null==(g=(f=n).onSuccess)||g.call(f,e,r,n);return e}catch(C){var h,v;if(d.current<=m)if(a((()=>_({error:C,isMutating:!1}))),null==(h=(v=n).onError)||h.call(v,C,r,n),n.throwOnError)throw C}}),[]),v=(0,o.useCallback)((()=>{d.current=(0,s.u3)(),_({data:s.i_,error:s.i_,isMutating:!1})}),[]);return(0,s.LI)((()=>{u.current=t,c.current=e,l.current=r})),{trigger:h,reset:v,get data(){return g.data=!0,f.data},get error(){return g.error=!0,f.error},get isMutating(){return g.isMutating=!0,f.isMutating}}}))}},function(t){t.O(0,[795,9774,2888,179],(function(){return e=26068,t(t.s=e);var e}));var e=t.O();_N_E=e}]);